<!DOCTYPE html>
<html>

<head>
    <!--Import Google Icon Font-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!--Import materialize.css-->
    <link type="text/css" rel="stylesheet" href="lib/materialize/css/materialize.css" media="screen,projection"/>
    <link type="text/css" rel="stylesheet" href="css/home2.css"/>
    <!--Let browser know website is optimized for mobile-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta charset="utf-8"/>
</head>

<body>
<!-- Dropdown Structure -->
<div id="my_mod_modal" class="modal modal-fixed-footer">
    <div class="modal-content">
        <h4>管理我的信息</h4>
        <div class="row">
            <div class="input-field col s12">
                <input disabled id="my_name" type="text" class="validate">
                <label id="lab_my_name" for="my_name">用户姓名</label>
            </div>
            <div class="input-field col s12">
                <input id="acc_pas_old" type="password" class="validate">
                <label for="acc_pas_old">输入旧密码</label>
                <span class="helper-text" data-error="请输入原密码" id="pasErr"/>
            </div>
            <div class="input-field col s12">
                <input id="acc_pas_new" type="password" class="validate">
                <label for="acc_pas_new">输入新密码</label>
                <span class="helper-text" data-error="请输入新密码"/>
            </div>
            <div class="input-field col s12">
                <input id="acc_pas_new1" type="password" class="validate">
                <label for="acc_pas_new1">确认新密码</label>
                <span class="helper-text" data-error="两次输入密码不相同"/>
            </div>
        </div>
    </div>
    <div class="modal-footer">
        <a class="modal-action modal-close waves-effect waves-green btn-flat ">关闭</a>
        <a class="modal-action waves-effect waves-green btn-flat " onclick="modifyMe()">确定修改</a>
    </div>
</div>
<div id="my_group" class="modal modal-fixed-footer">
    <div class="modal-content">
        <h4>小组介绍</h4>
        <div class="row">
            <table class="striped centered s12 m12 l12 ">
                <thead>
                <tr>
                    <th data-field="name">组员</th>
                    <th data-field="id">学号</th>
                </tr>
                </thead>

                <tbody>
                <tr>
                    <td>王芸琦</td>
                    <td>31501110</td>
                </tr>
                <tr>
                    <td>胡添策</td>
                    <td>31501115</td>
                </tr>
                <tr>
                    <td>陈禹彬</td>
                    <td>31501112</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
<header>
    <ul id="dropdown1" class="dropdown-content">
        <li>
            <a class="waves-effect waves-light modal-trigger" href="#my_mod_modal">管理我的</a>
        </li>
        <li class="divider"></li>
        <li>
            <a class="waves-effect waves-light" href="index.html">退出登录</a>
        </li>
    </ul>
    <nav class="nav-extended">
        <div class="nav-wrapper">
            <a href="home.html" class="brand-logo">实验室管理系统</a>
            <a href="#" data-target="mobile-demo" class="sidenav-trigger"><i class="material-icons">menu</i></a>
            <ul id="nav-mobile" class="right hide-on-med-and-down">
                <li>
                    <a class="dropdown-trigger" href="#!" data-target="dropdown1">用户中心<i class="material-icons right">arrow_drop_down</i></a>
                </li>
                <li>
                    <a class="waves-effect waves-light modal-trigger" href="#my_group">信息</a>
                </li>
            </ul>
            <ul class="sidenav" id="mobile-demo">

                <li>
                    <a class="waves-effect waves-light modal-trigger" href="#my_mod_modal">管理我的</a>
                </li>
                <li>
                    <a class="waves-effect waves-light modal-trigger" href="#my_group">信息</a>
                </li>
                <li>
                    <a class="waves-effect waves-light" href="index.html">退出登录</a>
                </li>
            </ul>
        </div>
        <div class="nav-content">
            <ul class="tabs tabs-transparent">
                <li class="tab">
                    <a href="#lab">实验室管理</a>
                </li>
                <li class="tab">
                    <a href="#com">计算机管理</a>
                </li>
                <li class="tab">
                    <a href="#acc">用户管理</a>
                </li>
                <!--<li class="tab">
                    <a href="#any">统计分析</a>
                </li>-->
            </ul>
        </div>
    </nav>
</header>
<div class="my-right">
    <div id="lab" class="container">
        <div class="row">
            <!--<form class="col s12">-->
                <!--<div class="row">-->
                    <!--<div class="input-field col s12 m6 l3">-->
                        <!--<input id="lab_name" type="text" class="validate">-->
                        <!--<label for="lab_name">实验室名称</label>-->
                    <!--</div>-->
                    <!--<div class="input-field col s12 m6 l3">-->
                        <!--<input id="lab_lead" type="text" class="validate">-->
                        <!--<label for="lab_lead">实验室管理员</label>-->
                    <!--</div>-->
                    <!--<div class="input-field col s12 m6 l3">-->
                        <!--<input id="lab_loc" type="text" class="validate">-->
                        <!--<label for="lab_loc">实验室位置</label>-->
                    <!--</div>-->
                    <!--<div class="input-field col s12 m6 l3">-->
                        <!--<select id="lab_safe">-->
                            <!--<option value="" disabled selected>实验室安全等级</option>-->
                            <!--<option value="1">A</option>-->
                            <!--<option value="2">B</option>-->
                            <!--<option value="3">C</option>-->
                            <!--<option value="3">D</option>-->
                        <!--</select>-->
                        <!--<label id="label_lab_safe">实验室安全等级</label>-->
                    <!--</div>-->
                <!--</div>-->
            <!--</form>-->
            <div class="row">
                <br>
                <div class=" left-align col s6 m6 l6">
                    <a class="modal-trigger waves-effect waves-light btn green modal-trigger"
                       href="#lab_add_modal1" onclick="openCreateLab()">添加</a>
                </div>
                <!--<div class=" right-align col s6 m6 l6">-->
                    <!--<a class="waves-effect waves-light btn blue" onclick="searchLab()">查询<i class="material-icons right">search</i></a>-->
                    <!--<a class="waves-effect waves-light btn grey" onclick="window.location.reload()">重置</a>-->
                <!--</div>-->
            </div>
            <div id="lab_add_modal1" class="modal modal-fixed-footer">
                <div class="modal-content">
                    <h4>添加实验室</h4>
                    <div class="row">
                        <div class="input-field col s12">
                            <input id="lab_name_add" type="text" class="validate">
                            <label for="lab_name_add">请输入实验室名称</label>
                        </div>
                        <div class="input-field col s12">
                            <select id="lab_lead_add" type="text" class="validate">
                            </select>
                            <label for="lab_lead_add">请输入实验室管理员</label>
                        </div>
                        <div class="input-field col s12">
                            <input id="lab_loc_add" type="number" class="validate">
                            <label for="lab_loc_add">请输入实验室位置</label>
                        </div>
                        <div class="input-field col s12">
                            <select id="lab_safe_level_add">
                                <option value="" disabled selected>实验室安全等级</option>
                                <option value="1">A</option>
                                <option value="2">B</option>
                                <option value="3">C</option>
                                <option value="3">D</option>
                            </select>
                            <label>请选择实验室安全等级</label>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <a href="#!" class="modal-action waves-effect waves-green btn-flat" onclick="createLab()">确定添加</a>
                </div>

            </div>
            <div id="lab_look_modal" class="modal bottom-sheet">
                <div class="modal-content container">
                    <h4>实验室计算机使用情况</h4>
                    <table class="striped centered   s12 m12 l12 ">
                        <thead>
                        <tr>
                            <th data-field="desk">桌号</th>
                            <th data-field="sum_time">使用总时长</th>
                            <th data-field="sum_numk">使用总次数</th>
                        </tr>
                        </thead>
                        <tbody id="look_lab">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="home-table ">
            <table class="striped centered   s12 m12 l12 ">
                <thead>
                <tr>
                    <th data-field="id">ID</th>
                    <th data-field="name">实验室名称</th>
                    <th data-field="lead">实验室管理员</th>
                    <th data-field="location">实验室位置</th>
                    <th data-field="save">实验室安全等级</th>
                    <th data-field="look">操作</th>
                </tr>
                </thead>
                <div id="lab_mod_modal1" class="modal modal-fixed-footer">
                    <div class="modal-content">
                        <h4>修改实验室</h4>
                        <div class="row">
                            <div class="input-field col s12">
                                <input id="lab_name_mod" type="text" class="validate">
                                <label for="lab_name_mod" id="label_lab_name_mod">实验室名称</label>
                            </div>
                            <div class="input-field col s12">
                                <input id="lab_lead_mod" type="text" class="validate">
                                <label for="lab_lead_mod" id="label_lab_lead_mod">实验室管理员</label>
                            </div>
                            <div class="input-field col s12">
                                <input id="lab_loc_mod" type="text" class="validate">
                                <label for="lab_loc_mod" id="label_lab_loc_mod">实验室位置</label>
                            </div>
                            <div class="input-field col s12">
                                <select id="lab_safe_mod">
                                    <option value="" disabled>实验室安全等级</option>
                                    <option value="1">A</option>
                                    <option value="2">B</option>
                                    <option value="3">C</option>
                                    <option value="3">D</option>
                                </select>
                                <label id="label_lab_safe_mod">实验室安全等级</label>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <a id="lab_mod_confirm" href="#!"
                           class="modal-action waves-effect waves-green btn-flat">确定修改</a>
                    </div>
                </div>
                <tbody id="table_lab">
                </tbody>
            </table>
        </div>
    </div>

    <div id="com" class="container">
        <div class="row">
            <!--<form class="col s12">-->
                <!--<div class="row">-->
                    <!--<div class="input-field col s12 m6">-->
                        <!--<input id="com_num" type="number" class="validate">-->
                        <!--<label for="com_num">计算机桌号</label>-->
                    <!--</div>-->
                    <!--<div class="input-field col s12 m6">-->
                        <!--<select id="com_lab_name">-->
                            <!--<option value="" disabled selected>实验室名称</option>-->
                        <!--</select>-->
                        <!--<label>所在实验室名称</label>-->
                    <!--</div>-->
                <!--</div>-->
            <!--</form>-->
            <div id="com_mod_modal1" class="modal modal-fixed-footer">
                <div class="modal-content">
                    <h4>修改计算机</h4>
                    <div class="row">
                        <div class="input-field col s12">
                            <input id="com_ip_mod" type="text" class="validate">
                            <label for="com_ip_mod" id="label_com_ip_mod">计算机IP</label>
                        </div>
                        <div class="input-field col s12">
                            <input id="com_num_mod" type="number" class="validate">
                            <label for="com_num_mod" id="label_com_num_mod">计算机桌号</label>
                        </div>
                        <div class="input-field col s12">
                            <select id="com_lab_name_mod">
                                <option value="" disabled selected>实验室名称</option>
                            </select>
                            <label id="label_com_lab_name_mod">所在实验室名称</label>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <a href="#!" id="com_mod_confirm"
                       class="modal-action waves-effect waves-green btn-flat ">确定修改</a>
                </div>
            </div>
            <div class="row">
                <br>
                <div class="left-align col s6 m6 l6">
                    <a class="modal-trigger waves-effect waves-light btn green" href="#com_add_modal1"
                       onclick="openCreateCom()">添加</a>
                </div>
                <!--<div class="right-align col s6 m6 l6">-->
                    <!--<a class="waves-effect waves-light btn blue">查询<i class="material-icons right">search</i></a>-->
                    <!--<a class="waves-effect waves-light btn grey" onclick="window.location.reload()">重置</a>-->
                <!--</div>-->
            </div>
            <div id="com_add_modal1" class="modal modal-fixed-footer">
                <div class="modal-content">
                    <h4>添加计算机</h4>

                    <div class="row">
                        <div class="input-field col s12">
                            <input id="com_ip_add" type="text" class="validate">
                            <label for="com_ip_add">计算机IP</label>
                        </div>
                        <div class="input-field col s12">
                            <input id="com_num_add" type="number" class="validate">
                            <label for="com_num_add">计算机桌号</label>
                        </div>
                        <div class="input-field col s12">
                            <select id="com_lab_add">
                            </select>
                            <label>所在实验室名称</label>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <a href="#!" class="modal-action waves-effect waves-green btn-flat" onclick="createCom()">确定添加</a>
                </div>
            </div>
            <div id="com_look_modal1" class="modal bottom-sheet">
                <div class="modal-content container">
                    <h4>计算机使用情况</h4>
                    <table class="striped centered s12 m12 l12 ">
                        <thead>
                        <tr>
                            <th data-field="sum_time">使用总时长</th>
                            <th data-field="sum_numk">使用总次数</th>
                        </tr>
                        </thead>

                        <tbody id="comUse">
                        </tbody>
                    </table>
                    <br/>
                    <h5>详细信息</h5>
                    <table class="striped centered   s12 m12 l12 ">
                        <thead>
                        <tr>
                            <th data-field="acc_id">用户id</th>
                            <th data-field="in">上线时间</th>
                            <th data-field="out">下线时间</th>
                        </tr>
                        </thead>

                        <tbody id="login_list">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="home-table ">
            <table class="striped centered   s12 m12 l12 ">
                <thead>
                <tr>
                    <th data-field="id">ID</th>
                    <th data-field="ip">计算机IP</th>
                    <th data-field="desk">计算机桌号</th>
                    <th data-field="labname">实验室名称</th>
                    <th data-field="look">操作</th>
                </tr>
                </thead>

                <tbody id="table_com">
                </tbody>
            </table>
        </div>
    </div>

    <div id="acc" class="container">
        <div class="row">
            <!--<form class="col s12">-->
                <!--<div class="row">-->
                    <!--<div class="input-field col s12 m4">-->
                        <!--<input id="acc_id" type="text" class="validate">-->
                        <!--<label for="acc_id">用户ID</label>-->
                    <!--</div>-->
                    <!--<div class="input-field col s12 m4">-->
                        <!--<input id="acc_name" type="text" class="validate">-->
                        <!--<label for="acc_name">用户姓名</label>-->
                    <!--</div>-->
                    <!--<div class="input-field col s12 m4">-->
                        <!--<select>-->
                            <!--<option value="" disabled selected>用户类别</option>-->
                            <!--<option value="1">User</option>-->
                            <!--<option value="2">Leader</option>-->
                        <!--</select>-->
                        <!--<label>用户类别</label>-->
                    <!--</div>-->
                <!--</div>-->
            <!--</form>-->
            <div id="acc_mod_modal1" class="modal modal-fixed-footer">
                <div class="modal-content">
                    <h4>修改用户</h4>
                    <div class="row">
                        <div class="input-field col s12">
                            <input id="acc_name_mod" type="text" class="validate">
                            <label for="acc_name_mod" id="label_acc_name_mod">用户姓名</label>
                        </div>
                        <div class="input-field col s12">
                            <input id="acc_pas_mod" type="password" class="validate">
                            <label for="acc_pas_mod" id="label_acc_pas_mod">用户密码</label>
                        </div>
                        <div class="input-field col s12 ">
                            <input id="acc_tel_mod" type="text" class="validate">
                            <label for="acc_tel_add" id="label_acc_tel_mod">用户联系方式</label>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <a href="#!" id="user_mod_confirm"
                       class="modal-action waves-effect waves-green btn-flat ">确定修改</a>
                </div>
            </div>
            <div id="acc_look_modal1" class="modal bottom-sheet">
                <div class="modal-content container">
                    <h4>用户上机情况</h4>

                    <table class="striped centered s12 m12 l12 ">
                        <thead>
                        <tr>
                            <th data-field="lab_name">上机总时长</th>
                            <th data-field="desk">上机总次数</th>
                        </tr>
                        </thead>

                        <tbody id="user_com">
                        </tbody>
                    </table>
                    <br/>
                    <h5>详细信息</h5>
                    <table class="striped centered   s12 m12 l12 ">
                        <thead>
                        <tr>
                            <th data-field="lab_name">实验室名称</th>
                            <th data-field="desk">实验室桌号</th>
                            <th data-field="in">上线时间</th>
                            <th data-field="out">下线时间</th>
                        </tr>
                        </thead>

                        <tbody id="user_detail">
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="row">
                <br>
                <div class="left-align col s6 m6 l6">
                    <a class="modal-trigger waves-effect waves-light btn green" href="#acc_add_modal1">添加</a>
                </div>
                <!--<div class="right-align col s6 m6 l6">-->
                    <!--<a class="waves-effect waves-light btn blue">查询<i class="material-icons right">search</i></a>-->
                    <!--<a class="waves-effect waves-light btn grey" onclick="window.location.reload()">重置</a>-->
                <!--</div>-->
            </div>
            <div id="acc_add_modal1" class="modal modal-fixed-footer">
                <div class="modal-content">
                    <h4>添加用户</h4>

                    <div class="row">
                        <div class="input-field col s12 ">
                            <input id="acc_id_add" type="text" class="validate">
                            <label for="acc_id_add" id="label_acc_id_add">用户ID</label>
                        </div>
                        <div class="input-field col s12 ">
                            <input id="acc_name_add" type="text" class="validate">
                            <label for="acc_name_add" id="label_acc_name_add">用户姓名</label>
                        </div>
                        <div class="input-field col s12 ">
                            <input id="acc_pas_add" type="password" class="validate">
                            <label for="acc_pas_add" id="label_acc_pas_add">用户密码</label>
                        </div>
                        <div class="input-field col s12 ">
                            <input id="acc_tel_add" type="text" class="validate">
                            <label for="acc_tel_add" id="label_acc_tel_add">用户联系方式</label>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <a href="#!" class="modal-action waves-effect waves-green btn-flat "onclick="createUser()">确定添加</a>
                </div>
            </div>
        </div>
        <div class="home-table ">
            <table class="striped centered   s12 m12 l12 ">
                <thead>
                <tr>
                    <th data-field="id">ID</th>
                    <th data-field="name">姓名</th>
                    <th data-field="tel">联系方式</th>
                    <th data-field="class">用户类别</th>
                    <th data-field="look">操作</th>
                </tr>
                </thead>

                <tbody id="table_user">
                </tbody>
            </table>
        </div>
    </div>
</div>
<script type="text/javascript " src="lib/jquery/jquery-3.3.1.js"></script>
<script type="text/javascript " src="lib/materialize/js/materialize.js "></script>
<script src="lib/jquery/jquery-cookie.js"></script>
<script>
    let json;
    $(document).ready(function () {
        M.AutoInit();
        $('.modal').modal();
        $('.sidenav').sidenav();
        $('select').formSelect();
        $.ajax({
            type: 'POST',
            url: 'http://127.0.0.1:8080/mainPage',
            data: {method: "load"},
            header: {'Access-Control-Allow-Origin': '*'},
            success: function (data) {
                console.log(data);
                load(data)
            }
        });
    });

    function load(data) {
        json = JSON.parse(data);
        $("#table_lab").empty();
        for (let i in json["lab"]) {
            let lab = "<tr><td>" + json["lab"][i]["labId"] + "</td><td>" + json["lab"][i]["labName"] +
                "</td><td>" + json["lab"][i]["labLeader"] + "</td><td>" + json["lab"][i]["location"] +
                "</td><td>" + json["lab"][i]["safeLevel"] + "</td><td>" +
                "<a class='waves-effect waves-light btn indigo modal-trigger' href='#lab_look_modal' onclick='lookLab(" + json["lab"][i]["labId"] + ")'>查看</a>" +
                "<a class='waves-effect waves-light btn purple modal-trigger' href='#lab_mod_modal1' onclick='openModifyLab(" + i + ")'>修改</a>" +
                "<a class='waves-effect waves-light btn red ' onclick='return deleteLab(" + json["lab"][i]["labId"] + ")'>删除</i></a>" +
                "</td></tr>";
            $("#table_lab").append(lab);
            $("#com_lab_name").append("<option value='"+i+"' >"+json["lab"][i]["labName"]+"</option>");
        }

        $("#table_com").empty();
        for (let j in json["com"]) {
            let com = "<tr><td>" + json["com"][j]["computerId"] + "</td><td>" + json["com"][j]["ipAddress"] +
                "</td><td>" + json["com"][j]["location"] + "</td><td>" + json["com"][j]["labName"] + "</td><td>" +
                "<a class='waves-effect waves-light btn indigo modal-trigger' href='#com_look_modal1' onclick='lookCom(" + json["com"][j]["computerId"] + ")'>查看</a>" +
                "<a class='waves-effect waves-light btn purple modal-trigger' href='#com_mod_modal1' onclick='openModifyCom(" + j + ")'>修改</a>" +
                "<a class='waves-effect waves-light btn red ' onclick='return deleteCom(" + json["com"][j]["computerId"] + ")'>删除</i></a>" +
                "</td></tr>";
            $("#table_com").append(com);
        }
        $("#table_user").empty();
        for (let k in json["user"]) {
            let user = "<tr><td>" + json["user"][k]["userId"] + "</td><td>" + json["user"][k]["userName"] +
                "</td><td>" + json["user"][k]["tel"] + "</td><td>";
            if (json["user"][k]["userType"] == "1") {
                user += "Leader";
            }
            else {
                user += "User";
            }
            user += "</td><td>" + "<a class='waves-effect waves-light btn indigo modal-trigger' href='#acc_look_modal1' onclick='lookUser(" + json["user"][k]["userId"] + ")'>查看</a>" +
                "<a class='waves-effect waves-light btn purple modal-trigger' href='#acc_mod_modal1'onclick='openModifyUser(" + k + ")'>修改</a>" +
                "<a class='waves-effect waves-light btn red ' onclick='return deleteUser(" + json["user"][k]["userId"] + ")'>删除</i></a>" +
                "</td></tr>";
            $("#table_user").append(user);
        }
        $("#my_name").attr("value", JSON.parse($.cookie("loginCookie"))["username"])
        $("#lab_my_name").attr("class", "active")
        $('select').formSelect();
    }

    function deleteLab(labId) {
        let r = confirm("确定要删除这个实验室吗？");
        if (r == true) {
            $.ajax({
                type: 'POST',
                url: 'http://127.0.0.1:8080/mainPage',
                data: {method: "delLab", username: JSON.parse($.cookie("loginCookie"))["username"], labId: labId},
                header: {'Access-Control-Allow-Origin': '*'},
                success: function (data) {
                    console.log(data);
                    if (JSON.parse(data)["success"] == 1) {
                        reLoad();
                    }
                    else {
                        alert("删除失败");
                    }
                }
            });
        }
    }

    function deleteCom(comId) {
        let r = confirm("确定要删除这台计算机吗？");
        if (r == true) {
            $.ajax({
                type: 'POST',
                url: 'http://127.0.0.1:8080/mainPage',
                data: {method: "delCom", username: JSON.parse($.cookie("loginCookie"))["username"], comId: comId},
                header: {'Access-Control-Allow-Origin': '*'},
                success: function (data) {
                    console.log(data);
                    if (JSON.parse(data)["success"] == 1) {
                        reLoad();
                    }
                    else {
                        alert("删除失败");
                    }
                }
            });
        }
    }

    function deleteUser(userId) {
        let r = confirm("确定要删除这个用户吗？");
        if (r == true) {
            $.ajax({
                type: 'POST',
                url: 'http://127.0.0.1:8080/mainPage',
                data: {method: "delUser", username: JSON.parse($.cookie("loginCookie"))["username"], userId: userId},
                header: {'Access-Control-Allow-Origin': '*'},
                success: function (data) {
                    console.log(data);
                    if (JSON.parse(data)["success"] == 1) {
                        reLoad();
                    }
                    else {
                        alert("删除失败");
                    }
                }
            });
        }
    }

    function lookLab(labId) {
        $.ajax({
            type: 'POST',
            url: 'http://127.0.0.1:8080/mainPage',
            data: {method: "lookLab", labId: labId},
            header: {'Access-Control-Allow-Origin': '*'},
            success: function (data) {
                $("#look_lab").empty();
                let lookLabList = JSON.parse(data);
                console.log(data);
                for (let i in lookLabList) {
                    let looklab = "<tr><td>" + lookLabList[i]["location"] + "</td><td>" + lookLabList[i]["useTime"] + "</td><td>" + lookLabList[i]["useCount"] + "</td></tr>"
                    $("#look_lab").append(looklab);
                }
            }
        });
    }

    function lookCom(computerId) {
        $.ajax({
            type: 'POST',
            url: 'http://127.0.0.1:8080/mainPage',
            data: {method: "lookCom", computerId: computerId},
            header: {'Access-Control-Allow-Origin': '*'},
            success: function (data) {
                console.log(data);
                let lookComList = JSON.parse(data);
                $("#comUse").empty();
                $("#login_list").empty();
                let comUse = "<tr><td>" + lookComList["comUse"]["useTime"] + "</td><td>" + lookComList["comUse"]["useCount"] + "</td></tr>";
                $("#comUse").append(comUse);
                for (let i in lookComList["login"]) {
                    let loginList = "<tr><td>" + lookComList["login"][i]["userId"] + "</td><td>" + lookComList["login"][i]["inTime"] + "</td><td>" + lookComList["login"][i]["outTime"] + "</td></tr>";
                    $("#login_list").append(loginList);
                }
            }
        });
    }

    function lookUser(userId) {
        $.ajax({
            type: 'POST',
            url: 'http://127.0.0.1:8080/mainPage',
            data: {method: "lookUser", userId: userId},
            header: {'Access-Control-Allow-Origin': '*'},
            success: function (data) {
                console.log(data);
                let lookUserList = JSON.parse(data);
                $("#user_com").empty();
                $("#user_detail").empty();
                let usercom = "<tr><td>" + lookUserList["comUse"]["useTime"] + "</td><td>" + lookUserList["comUse"]["useCount"] + "</td></tr>";
                $("#user_com").append(usercom);
                for (let i in lookUserList["useDetail"]) {
                    let useDetail = "<tr><td>" + lookUserList["useDetail"][i]["labName"] + "</td><td>" + lookUserList["useDetail"][i]["location"] + "</td><td>" + lookUserList["useDetail"][i]["inTime"] + "</td><td>" + lookUserList["useDetail"][i]["outTime"] + "</td></tr>";
                    $("#user_detail").append(useDetail);
                }
            }
        });
    }

    function openModifyLab(i) {
        $("#lab_name_mod").attr("value", json["lab"][i]["labName"]);
        $("#label_lab_name_mod").attr("class", "active");
        $("#lab_lead_mod").attr("value", json["lab"][i]["labLeader"]);
        $("#label_lab_lead_mod").attr("class", "active");
        $("#lab_loc_mod").attr("value", json["lab"][i]["location"]);
        $("#label_lab_loc_mod").attr("class", "active");
        $("#lab_safe_mod").find("option[value=" + json["lab"][i]["safeLevel"] + "]").attr("class", "selected");
        $("#label_lab_safe_mod").attr("class", "active");
        $("#lab_mod_confirm").attr("onclick", "modifyLab(" + json["lab"][i]["labId"] + ")");
    }

    function modifyLab(labId) {
        console.log(labId);
        $.ajax({
            type: 'POST',
            url: 'http://127.0.0.1:8080/mainPage',
            data: {
                method: "modifyLab",
                username: JSON.parse($.cookie("loginCookie"))["username"],
                labId: labId,
                labName: $("#lab_name_mod").val(),
                labLeader: $("#lab_lead_mod").val(),
                location: $("#lab_loc_mod").val(),
                safeLevel: $("#lab_safe_mod").val()
            },
            header: {'Access-Control-Allow-Origin': '*'},
            success: function (data) {
                console.log(data);
                if (JSON.parse(data)["success"] == 1) {
                    reLoad();
                    $("#lab_mod_modal1").modal("close");
                }
                else {
                    alert("修改失败");
                }
            }
        });
    }

    function openModifyCom(i) {
        $("#com_ip_mod").attr("value", json["com"][i]["ipAddress"]);
        $("#label_com_ip_mod").attr("class", "active");
        $("#com_num_mod").attr("value", json["com"][i]["location"]);
        $("#label_com_num_mod").attr("class", "active");
        $("#com_lab_name_mod").empty();
        for (let j in json["lab"]) {
            console.log(json["lab"][j]["labName"]);
            $("#com_lab_name_mod").append("<option value='" + j + "'>" + json["lab"][j]["labName"] + "</option>");
        }
        $('select').formSelect();
        $("#com_lab_name_mod").find("option[value=" + json["com"][i]["labId"] + "]").attr("class", "selected");
        $("#com_mod_confirm").attr("onclick", "modifyCom(" + json["com"][i]["computerId"] + ")");
    }

    function modifyCom(computerId) {
        $.ajax({
            type: 'POST',
            url: 'http://127.0.0.1:8080/mainPage',
            data: {
                method: "modifyCom",
                username: JSON.parse($.cookie("loginCookie"))["username"],
                computerId: computerId,
                ipAddress: $("#com_ip_mod").val(),
                location: $("#com_num_mod").val(),
                labId: json["lab"][$("#com_lab_name_mod").val()]["labId"]
            },
            header: {'Access-Control-Allow-Origin': '*'},
            success: function (data) {
                console.log(data);
                if (JSON.parse(data)["success"] == 1) {
                    reLoad();
                    $("#com_mod_modal1").modal("close");
                }
                else {
                    alert("修改失败");
                }
            }
        });
    }

    function openModifyUser(i) {
        $("#acc_name_mod").attr("value", json["user"][i]["userName"]);
        $("#label_acc_name_mod").attr("class", "active");
        $("#acc_tel_mod").attr("value", json["user"][i]["tel"]);
        $("#label_acc_tel_mod").attr("class", "active");
        $("#user_mod_confirm").attr("onclick", "modifyUser(" + json["user"][i]["userId"] + ")");

    }

    function modifyUser(userId) {
        $.ajax({
            type: 'POST',
            url: 'http://127.0.0.1:8080/mainPage',
            data: {
                method: "modifyUser",
                username: JSON.parse($.cookie("loginCookie"))["username"],
                userId: userId,
                acc_name: $("#acc_name_mod").val(),
                acc_psd: $("#acc_pas_mod").val(),
                tel: $("#acc_tel_mod").val()
            },
            header: {'Access-Control-Allow-Origin': '*'},
            success: function (data) {
                console.log(data);
                if (JSON.parse(data)["success"] == 1) {
                    reLoad();
                    $("#acc_mod_modal1").modal("close");
                }
                else {
                    alert("修改失败");
                }
            }
        });
    }

    function openCreateLab() {
        $("#lab_lead_add").empty();
        for (let i in json["user"]) {
            $("#lab_lead_add").append("<option value='" + i + "'>" + json["user"][i]["userName"] + "</option>");
        }
        $('select').formSelect();
    }

    function createLab() {
        if ($("#lab_name_add").val() == "") {
            $("#lab_name_add").attr("class", "validate invalid");
        }
        else if ($("#lab_loc_add").val() == "") {
            $("#lab_loc_add").attr("class", "validate invalid");
        }
        else if ($("#lab_safe_level_add").val() == null) {
            $("#lab_safe_level_add").attr("class", "validate invalid");
        }
        else {
            $.ajax({
                type: 'POST',
                url: 'http://127.0.0.1:8080/mainPage',
                data: {
                    method: "createLab",
                    username: JSON.parse($.cookie("loginCookie"))["username"],
                    labName: $("#lab_name_add").val(),
                    labLeader: json["user"][$("#lab_lead_add").val()]["userId"],
                    location: $("#lab_loc_add").val(),
                    safeLevel: $("#lab_safe_level_add").val()
                },
                header: {'Access-Control-Allow-Origin': '*'},
                success: function (data) {
                    console.log(data);
                    if (JSON.parse(data)["success"] == 1) {
                        reLoad();
                        $("#lab_add_modal1").modal("close");
                    }
                    else {
                        alert("添加失败");
                    }
                }
            });
        }
    }

    function openCreateCom() {
        $("#com_lab_add").empty();
        for (let i in json["lab"]) {
            $("#com_lab_add").append("<option value='" + i + "'>" + json["lab"][i]["labName"] + "</option>");
        }
        $('select').formSelect();
    }

    function createCom() {
        let reg = /^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;
        if (!reg.test($("#com_ip_add").val())) {
            $("#com_ip_add").attr("class", "validate invalid");
        }
        else if ($("#com_num_add").val() == "") {
            $("#com_num_add").attr("class", "validate invalid");
        }
        else {
            $.ajax({
                type: 'POST',
                url: 'http://127.0.0.1:8080/mainPage',
                data: {
                    method: "createCom",
                    username: JSON.parse($.cookie("loginCookie"))["username"],
                    ipAddress: $("#com_ip_add").val(),
                    location: $("#com_num_add").val(),
                    labId: json["lab"][$("#com_lab_add").val()]["labId"]
                },
                header: {'Access-Control-Allow-Origin': '*'},
                success: function (data) {
                    console.log(data);
                    if (JSON.parse(data)["success"] == 1) {
                        reLoad();
                        $("#com_add_modal1").modal("close");
                    }
                    else {
                        alert("创建失败");
                    }
                }
            });
        }

    }

    function createUser() {
        if ($("#acc_id_add").val() == "") {
            $("#label_acc_id_add").attr("class", "validate invalid");
        }
        else if ($("#acc_name_add").val() == "") {
            $("#label_acc_name_add").attr("class", "validate invalid");
        }
        else if ($("#acc_pas_add").val() == "") {
            $("#label_acc_pas_add").attr("class", "validate invalid");
        }
        else if ($("#acc_tel_add").val() == "") {
            $("#label_acc_tel_add").attr("class", "validate invalid");
        }
        else {
            $.ajax({
                type: 'POST',
                url: 'http://127.0.0.1:8080/mainPage',
                data: {
                    method: "createUser",
                    username: JSON.parse($.cookie("loginCookie"))["username"],
                    userId: $("#acc_id_add").val(),
                    acc_name: $("#acc_name_add").val(),
                    acc_psd: $("#acc_pas_add").val(),
                    tel: $("#acc_tel_add").val()
                },
                header: {'Access-Control-Allow-Origin': '*'},
                success: function (data) {
                    console.log(data);
                    if (JSON.parse(data)["success"] == 1) {
                        reLoad();
                        $("#acc_add_modal1").modal("close");
                    }
                    else {
                        alert("创建失败");
                    }
                }
            });
        }
    }

    function reLoad() {
        $.ajax({
            type: 'POST',
            url: 'http://127.0.0.1:8080/mainPage',
            data: {method: "load"},
            header: {'Access-Control-Allow-Origin': '*'},
            success: function (data) {
                console.log(data);
                load(data)
            }
        });
    }
</script>
</body>

</html>